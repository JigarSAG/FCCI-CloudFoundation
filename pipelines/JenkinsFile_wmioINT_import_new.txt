#!/usr/bin/env groovy

pipeline {
    agent any


    stages 
    {
        stage('Initialize Repo')
	  {  
	   steps 
		{
		  echo "----------------------------------Start Initialize Repo----------------------------------"
		  
		  script {
				source_environment_hostname = sh ( returnStdout: true, script: '''cat configs/wmioINT/QA.yml | grep -i hostname | cut -d '"' -f2 ''' ).trim()
				source_environment_port = sh ( returnStdout: true, script: '''cat configs/wmioINT/QA.yml | grep -i port | cut -d '"' -f2 ''' ).trim()
				source_repoName = "DEV"
				target_repoName = "QA"
				targetIoURL = "https://${source_environment_hostname}:${source_environment_port}"        
			}
			
			echo "${source_environment_hostname}"
			echo "${source_environment_port}"
			echo "${targetIoURL}"
		}
	   }

		 stage('Commit Asset To Terget Server')
		{  
			   echo "----------------------------------checkout Source Repo----------------------------------"
			   script{
					dir('FCCI-CloudFoundation-DEV')
						{
							sh 'pwd'
							sh 'ls -ltr' 	
						
								script {
											git branch: 'DEV',
											credentialsId: 'JigarSAG',
											url: 'https://github.com/JigarSAG/FCCI-CloudFoundation.git'
											sh "ls -lat"
									}
							sh '''
							echo $(pwd)

							cd export
							echo $(pwd)
							echo $(ls -lrt)

							cd project
							echo $(pwd)
							echo $(ls -lrt)
							
							FILE=./${ProjectName}.zip
							echo "proj exists ${fileexist}"
							
							if [ -f "$FILE" ]; then                    
                    
								echo "project file exists, starting to import..."

								git add $FILE
								git config --global user.name "Jigar Shah"
								git config --global user.email "jish@locahost.com"
								

								git commit -m "Add $projectName to repo"
								
								sh '''

								withCredentials([gitUsernamePassword(credentialsId: 'JigarSAG', gitToolName: 'Default')]) {
											sh "git push -u origin DEV"													
								}
								
								echo "Project Copied to Target successfully: ${ProjectName}"
							
							else
							
								echo "No file found to import for project ${ProjectName}"
							fi
							sh '''
						}
			   }
		}
        

    }
}
